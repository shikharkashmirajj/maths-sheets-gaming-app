<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Maths Sheets Gaming App</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f172a" />
  <style>
    body { font-family: Arial, sans-serif; background:#f9fafb; margin:0; padding:20px; text-align:center; }
    h1 { color:#0f172a; }
    .topic { background:#fff; margin:10px; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.15); display:flex; justify-content:space-between; align-items:center; }
    .topic button { background:#4f46e5; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; }
    .topic button:disabled { background:#9ca3af; cursor:not-allowed; }
    #scoreboard { background:#fff; margin:20px auto; padding:15px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.15); max-width:400px; }
    #scoreboard button { margin:5px; background:#22c55e; color:#fff; padding:8px 12px; border:none; border-radius:8px; cursor:pointer; }
    .progress-bar { background:#e5e7eb; border-radius:10px; height:20px; margin:10px 0; }
    .progress-fill { height:100%; background:#4f46e5; border-radius:10px; }
  </style>
</head>
<body>
  <h1>üéÆ Maths Sheets Gaming App</h1>
  <div id="scoreboard"></div>
  <h2>üìò Topics</h2>
  <div id="topics"></div>

<script>
const TOPICS = [
  { key:"average",   name:"‚öñÔ∏è Average" },
  { key:"algebra",   name:"‚ûï Algebra" },
  { key:"coordinate",name:"üìê Coordinate Geometry" },
  { key:"geometry",  name:"üìè Geometry" },
  { key:"hcf",       name:"‚ûó HCF" },
  { key:"height",    name:"‚õ∞Ô∏è Height & Distance" },
  { key:"mens",      name:"üì¶ Mensuration" },
  { key:"mixture",   name:"üß™ Mixture" },
  { key:"numbers",   name:"üî¢ Number System" },
  { key:"percent",   name:"üìä Percentage" },
  { key:"pnl",       name:"üí∞ Profit & Loss" },
  { key:"sici",      name:"üíµ SI & CI" },
  { key:"stats",     name:"üìà Statistics" },
  { key:"surds",     name:"‚àö Surds" },
  { key:"trig",      name:"üìê Trigonometry" },
  { key:"tsd",       name:"üöó Time, Speed & Distance" },
  { key:"twp",       name:"‚è≥ Time & Work" }
];

// Rank system with milestones
function getRank(points) {
  if (points >= 30001) return { title: "üëë CGL Maths Master", next: "Maxed Out" };
  if (points >= 15001) return { title: "ü•∑ Shortcut Ninja", next: "30,001 XP ‚Üí üëë CGL Maths Master" };
  if (points >= 5001)  return { title: "‚ö° Speed Solver", next: "15,001 XP ‚Üí ü•∑ Shortcut Ninja" };
  return { title: "ü™Ñ Apprentice", next: "5,001 XP ‚Üí ‚ö° Speed Solver" };
}

// Add bonus XP
function addBonusXP(amount) {
  let points = parseInt(localStorage.getItem("points") || "0");
  points += amount;
  localStorage.setItem("points", points);
  renderDashboard();
}

// Render topics
function renderTopics() {
  const container = document.getElementById("topics");
  container.innerHTML = "";
  let completed = JSON.parse(localStorage.getItem("completed") || "{}");

  TOPICS.forEach(t => {
    const div = document.createElement("div");
    div.className = "topic";
    div.innerHTML = `
      <span>${t.name}</span>
      <button ${completed[t.key] ? "disabled" : ""} onclick="completeTopic('${t.key}')">
        ${completed[t.key] ? "‚úÖ Done" : "Mark Complete"}
      </button>
    `;
    container.appendChild(div);
  });
}

// Mark topic complete
function completeTopic(key) {
  let completed = JSON.parse(localStorage.getItem("completed") || "{}");
  let points = parseInt(localStorage.getItem("points") || "0");
  let today = new Date().toDateString();
  let last = localStorage.getItem("lastDay");
  let streak = parseInt(localStorage.getItem("streak") || "0");

  if (!completed[key]) {
    completed[key] = true;
    localStorage.setItem("completed", JSON.stringify(completed));

    points += 10; // +10 XP per topic

    // Streak handling with penalty
    if (last !== today) {
      if (last && new Date(today) - new Date(last) > 86400000) {
        streak = 0;
        points = Math.max(0, points - 200); // deduct 200 XP
      } else {
        streak += 1;
      }
      localStorage.setItem("streak", streak);
      localStorage.setItem("lastDay", today);
    }

    localStorage.setItem("points", points);
    renderDashboard();
    renderTopics();
  }
}

// Dashboard with progress bar
function renderDashboard() {
  const points = parseInt(localStorage.getItem("points") || "0");
  const rankInfo = getRank(points);
  const streak = localStorage.getItem("streak") || 0;

  // Progress bar calculation
  let progress = 100;
  if (rankInfo.title === "ü™Ñ Apprentice") {
    progress = Math.min(100, (points/5000)*100);
  } else if (rankInfo.title === "‚ö° Speed Solver") {
    progress = Math.min(100, ((points-5000)/(15000-5000))*100);
  } else if (rankInfo.title === "ü•∑ Shortcut Ninja") {
    progress = Math.min(100, ((points-15000)/(30000-15000))*100);
  }

  document.getElementById("scoreboard").innerHTML = `
    <h2>‚≠ê Your Progress</h2>
    <p>Points: <b>${points}</b></p>
    <p>Rank: <b>${rankInfo.title}</b></p>
    <p>Next Rank: <b>${rankInfo.next}</b></p>
    <div class="progress-bar">
      <div class="progress-fill" style="width:${progress}%"></div>
    </div>
    <p>Streak: <b>${streak} days</b></p>
    <button onclick="addBonusXP(200)">üéØ Sectional Mock Test (+200 XP)</button>
    <button onclick="addBonusXP(100)">üìò Revision of Maths Notes (+100 XP)</button>
  `;
}

renderDashboard();
renderTopics();
</script>
</body>
</html>
